-baja logica de un usuario
CREATE TRIGGER trg_BajaLogicaUsuario
ON Usuario
INSTEAD OF DELETE
AS
BEGIN
    UPDATE Usuario
    SET Activo = 0,
        FechaModificacion = GETDATE()
    WHERE IDUsuario IN (SELECT IDUsuario FROM deleted);
END;
-- Actualiza la fecha de modificacion
CREATE TRIGGER trg_ActualizacionFechaModificacion
ON Usuario
AFTER UPDATE
AS
BEGIN
    UPDATE Usuario
    SET FechaModificacion = GETDATE()
    WHERE IDUsuario IN (SELECT IDUsuario FROM inserted);
END;
--impide la doble incripcion 
CREATE TRIGGER trg_EvitarDobleInscripcion
ON Inscripcion
INSTEAD OF INSERT
AS
BEGIN
    IF EXISTS (
        SELECT 1
        FROM Inscripcion I
        JOIN inserted ins ON I.IDCurso = ins.IDCurso AND I.IDParticipante = ins.IDParticipante
    )
    BEGIN
        RAISERROR('Ya existe una inscripci√≥n para ese participante en ese curso.', 16, 1);
        RETURN;
    END

    INSERT INTO Inscripcion (IDParticipante, IDCurso)
    SELECT IDParticipante, IDCurso FROM inserted;
END;
