-- Tabla Persona 
CREATE TABLE Persona (
    IDPersona INT PRIMARY KEY AUTO_INCREMENT,
    Nombre VARCHAR(50) NOT NULL,
    Apellido VARCHAR(50) NOT NULL,
    Email VARCHAR(100) UNIQUE,
    Telefono VARCHAR(20),
    FechaBaja DATETIME NULL,
    MotivoBaja VARCHAR(255) NULL
);

-- Tabla Usuario 
CREATE TABLE Usuario (
    IDUsuario INT PRIMARY KEY AUTO_INCREMENT,
    IDPersona INT NOT NULL,
    NombreUsuario VARCHAR(50) NOT NULL UNIQUE,
    Contraseña VARCHAR(255) NOT NULL,
    Rol ENUM('Administrador', 'Profesor', 'Participante') NOT NULL,
    FechaBaja DATETIME NULL,
    FOREIGN KEY (IDPersona) REFERENCES Persona(IDPersona)
);

-- Tabla Profesor
CREATE TABLE Profesor (
    IDProfesor INT PRIMARY KEY AUTO_INCREMENT,
    IDPersona INT NOT NULL,
    FechaBaja DATETIME NULL,
    FOREIGN KEY (IDPersona) REFERENCES Persona(IDPersona)
);

-- Tabla Cursos
CREATE TABLE Cursos (
    IDCurso INT PRIMARY KEY AUTO_INCREMENT,
    IDProfesor INT NOT NULL,
    Nombre VARCHAR(100) NOT NULL,
    FechaInicio DATE NOT NULL,
    FechaFin DATE NOT NULL,
    Horario VARCHAR(50),
    CupoMaximo INT NOT NULL,
    Estado ENUM('Activo', 'Inactivo', 'Completado', 'Cancelado') NOT NULL DEFAULT 'Activo',
    FechaBaja DATETIME NULL,
    FOREIGN KEY (IDProfesor) REFERENCES Profesor(IDProfesor)
);

-- Tabla Participante
CREATE TABLE Participante (
    IDParticipante INT PRIMARY KEY AUTO_INCREMENT,
    IDPersona INT NOT NULL,
    FechaBaja DATETIME NULL,
    FOREIGN KEY (IDPersona) REFERENCES Persona(IDPersona)
);

-- Tabla Accion Solidaria
CREATE TABLE AccionSolidaria (
    IDAccion INT PRIMARY KEY AUTO_INCREMENT,
    IDParticipante INT NOT NULL,
    NombreAccion VARCHAR(100) NOT NULL,
    Fecha DATE NOT NULL,
    Descripcion TEXT,
    FechaBaja DATETIME NULL,
    FOREIGN KEY (IDParticipante) REFERENCES Participante(IDParticipante)
);

-- Tabla Inscripcion
CREATE TABLE Inscripcion (
    IDInscripcion INT PRIMARY KEY AUTO_INCREMENT,
    IDParticipante INT NOT NULL,
    IDCurso INT NOT NULL,
    FechaInscripcion DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    Estado ENUM('Activa', 'Cancelada', 'Finalizada') NOT NULL DEFAULT 'Activa',
    FOREIGN KEY (IDParticipante) REFERENCES Participante(IDParticipante),
    FOREIGN KEY (IDCurso) REFERENCES Cursos(IDCurso),
    UNIQUE (IDParticipante, IDCurso) -- Evitar inscripciones duplicadas
);

-- Tabla Asistencia
CREATE TABLE Asistencia (
    IDAsistencia INT PRIMARY KEY AUTO_INCREMENT,
    IDInscripcion INT NOT NULL,
    Fecha DATE NOT NULL,
    Presente BOOLEAN NOT NULL DEFAULT FALSE,
    FOREIGN KEY (IDInscripcion) REFERENCES Inscripcion(IDInscripcion),
    UNIQUE (IDInscripcion, Fecha) -- Un registro por inscripción por fecha
);
